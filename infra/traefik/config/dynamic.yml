# Traefik Dynamic Configuration - File Provider
# This file defines manual routes to services running on wonko.local
# Traefik will hot-reload this file when changes are detected (watch=true)

http:
  # Routers define how to match incoming requests
  routers:
    # Kibana - Data visualization and exploration tool
    kibana:
      rule: "Host(`kibana.home`)"
      entryPoints:
        - "web"
      service: "kibana"

    # Elasticsearch - Search and analytics engine
    elasticsearch:
      rule: "Host(`es.home`) || Host(`elasticsearch.home`) || Host(`elasticsearch.omnidian.home`)"
      entryPoints:
        - "web"
      service: "elasticsearch"

    # n8n - Workflow automation (commented out, uncomment to enable)
    n8n:
      rule: "Host(`n8n.home`)"
      entryPoints:
        - "web"
      service: "n8n"

  # Prefect - Workflow orchestration (commented out, uncomment to enable)
    prefect:
      rule: "Host(`prefect.home`)"
      entryPoints:
        - "web"
      service: "prefect"

  # Neo4j - Graph database (commented out, uncomment to enable)
    neo4j-work-memories:
      rule: "Host(`neo4j.omnidian.home`)"
      entryPoints:
        - "web"
      service: "neo4j-work-memories"
   # neo4j-bolt-work-memories:
   #   rule: "Host(`bolt.neo4j.omnidian.home`)"
   #   entryPoints:
   #     - "web"
   #   service: "neo4j-bolt-work-memories"

  # NeoDash - Neo4j visualization dashboard (commented out, uncomment to enable)
    neodash:
      rule: "Host(`neodash.home`)"
      entryPoints:
        - "web"
      service: "neodash"

    # Homepage - Dashboard (commented out, uncomment to enable)
    # homepage:
    #   rule: "Host(`homepage.home`)"
    #   entryPoints:
    #     - "web"
    #   service: "homepage"
    # Pi-hole - Network-wide ad blocking (runs on orangepi5b with host networking)
    pihole:
      rule: "Host(`pihole.home`)"
      entryPoints:
        - "web"
      service: "pihole"

    pihole2:
      rule: "Host(`pihole2.home`)"
      entryPoints:
        - "web"
      service: "pihole2"

    # MCP Server - Model Context Protocol (commented out, uncomment to enable)
    mcp:
      rule: "Host(`mcp.home`)"
      entryPoints:
        - "web"
      service: "mcp"

    # Portainer - Container management (HTTPS backend)
    portainer:
      rule: "Host(`portainer.home`)"
      entryPoints:
        - "web"
      service: "portainer"

    # Mosquitto - MQTT web interface
    mosquitto:
      rule: "Host(`mosquitto.home`)"
      entryPoints:
        - "web"
      service: "mosquitto"

    # RabbitMQ - Message broker management interface
    rabbitmq:
      rule: "Host(`rabbitmq.home`)"
      entryPoints:
        - "web"
      service: "rabbitmq"

    # OpenHAB - Home automation platform
    openhab:
      rule: "Host(`openhab.home`)"
      entryPoints:
        - "web"
      service: "openhab"

    # Traefik Dashboard - Proxy dashboard
    traefik-dashboard:
      rule: "Host(`traefik.home`)"
      entryPoints:
        - "web"
      service: "traefik-dashboard"

    # LibreChat - LLM Chat Interface
    librechat:
      rule: "Host(`librechat.home`)"
      entryPoints:
        - "web"
      service: "librechat"

    # WUD - What's Up Docker (orangepi5b)
    wud:
      rule: "Host(`wud.home`) || Host(`docker-updates.home`)"
      entryPoints:
        - "web"
      service: "wud"

    # Duplicati - Backup for orangepi5b
    duplicati-orangepi5b:
      rule: "Host(`orangepi5b.backup.home`) || Host(`backup.home`)"
      entryPoints:
        - "web"
      service: "duplicati-orangepi5b"

    # Duplicati - Backup for wonko
    duplicati-wonko:
      rule: "Host(`wonko.backup.home`)"
      entryPoints:
        - "web"
      service: "duplicati-wonko"

    # Trade Goblin Stuff.
    trading-agents-api:
      rule: "Host(`api.trading-agents.trade-goblin.home`)"
      entryPoints:
        - "web"
      service: "trading-agents-api"



  # Services define backend servers
  services:
    # Kibana service pointing to wonko.local:5601
    kibana:
      loadBalancer:
        servers:
          - url: "http://wonko.local:5601"

    # Elasticsearch service pointing to wonko.local:9200
    elasticsearch:
      loadBalancer:
        servers:
          - url: "http://wonko.local:9200"

    # n8n service pointing to wonko.local:5678 (commented out)
    n8n:
      loadBalancer:
        servers:
          - url: "http://wonko.local:5678"

    # Prefect service pointing to wonko.local:4200
    prefect:
      loadBalancer:
        servers:
          - url: "http://wonko.local:4200"

    # Neo4j service pointing to wonko.local:7475
    neo4j-work-memories:
      loadBalancer:
        servers:
          - url: "http://wonko.local:7475"
   # neo4j-bolt-work-memories:
   #   loadBalancer:
   #     servers:
   #       - url: "bolt://wonko.local:7688"

    # NeoDash service pointing to wonko.local:5005
    neodash:
      loadBalancer:
        servers:
          - url: "http://wonko.local:5005"


    # MCP Server pointing to wonko.local:8000
    mcp:
      loadBalancer:
        servers:
          - url: "http://wonko.local:8000"

    # Pi-hole service pointing to localhost:8082 (runs on orangepi5b with host networking)
    pihole:
      loadBalancer:
        servers:
          - url: "http://pi.hole:8082/admin"
    pihole2:
      loadBalancer:
        servers:
          - url: "http://192.168.50.43:8082/admin"

    # Portainer service pointing to orangepi5b:9443 (HTTPS)
    portainer:
      loadBalancer:
        servers:
          - url: "https://orangepi5b.local:9443"
        serversTransport: insecureTransport

    # Mosquitto web interface pointing to orangepi5b:9002
    mosquitto:
      loadBalancer:
        servers:
          - url: "http://orangepi5b.local:9002"

    # RabbitMQ management interface pointing to orangepi5b:15672
    rabbitmq:
      loadBalancer:
        servers:
          - url: "http://orangepi5b.local:15672"

    # OpenHAB pointing to orangepi5b:8080
    openhab:
      loadBalancer:
        servers:
          - url: "http://orangepi5b.local:8080"

    # Traefik dashboard pointing to orangepi5b:9080
    traefik-dashboard:
      loadBalancer:
        servers:
          - url: "http://orangepi5b.local:9080"

    # LibreChat pointing to wonko.local:3080
    librechat:
      loadBalancer:
        servers:
          - url: "http://wonko.local:3080"

    # WUD pointing to orangepi5b:3000
    wud:
      loadBalancer:
        servers:
          - url: "http://orangepi5b.local:8230"

    # Duplicati orangepi5b pointing to orangepi5b:8200
    duplicati-orangepi5b:
      loadBalancer:
        servers:
          - url: "http://orangepi5b.local:8220"

    # Duplicati wonko pointing to wonko:8201
    duplicati-wonko:
      loadBalancer:
        servers:
          - url: "http://wonko.local:8221"


    trading-agents-api:
      loadBalancer:
        servers:
          - url: "http://wonko.local:8123"

  # ServersTransport for HTTPS backends with self-signed certificates
  serversTransports:
    insecureTransport:
      insecureSkipVerify: true

tcp:
  routers:
    neo4j-bolt:
      entryPoints: ["bolt"]
      rule: "HostSNI(`*`)"
      service: neo4j-bolt-svc

  services:
    neo4j-bolt-svc:
      loadBalancer:
        servers:
          - address: "wonko.local:7688"
