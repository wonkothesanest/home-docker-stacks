services:
  pihole:
    image: pihole/pihole:latest
    container_name: pihole
    restart: unless-stopped

    hostname: pihole

    # Use host networking so Pi-hole binds directly to host interfaces
    network_mode: host

    environment:
      # Timezone
      TZ: ${TZ:-America/Los_Angeles}

      # Web interface port configuration (using FTL config format)
      FTLCONF_webserver_port: 8082

      # Web interface password
      WEBPASSWORD: ${WEBPASSWORD}

      # DNS settings
      PIHOLE_DNS_: ${UPSTREAM_DNS:-1.1.1.1;1.0.0.1}  # Cloudflare by default

      # Web interface settings
      VIRTUAL_HOST: pihole.${DOMAIN:-homelab.local}

      # Performance
      DNSMASQ_LISTENING: all

      # Optional: Server IP for web interface
      ServerIP: ${SERVER_IP}

      # Custom DNS configuration for homelab.local domain
      # All *.homelab.local queries resolve to orangepi5b (Traefik)
      # Format: DNSMASQ_OPTS=--address=/domain/ip
      DNSMASQ_OPTS: --address=/homelab.local/${SERVER_IP}

    volumes:
      - ./pihole:/etc/pihole
      - ./dnsmasq.d:/etc/dnsmasq.d

    cap_add:
      - NET_ADMIN  # Required for DHCP server features (optional)

    dns:
      - 127.0.0.1      # Use itself for DNS after initial setup
      - 1.1.1.1        # Fallback DNS

    # Note: Traefik auto-discovery doesn't work with host networking
    # Access Pi-hole directly at http://10.0.0.192:8082/admin
    # For Traefik routing, add a file provider configuration in Traefik
