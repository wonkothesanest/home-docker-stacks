version: '3.8'

services:
  wud:
    image: fmartinou/whats-up-docker:latest
    container_name: wud
    restart: unless-stopped
    ports:
      - "${WUD_PORT:-3000}:3000"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - ./data:/store
    environment:
      # Basic configuration
      - WUD_LOG_LEVEL=${LOG_LEVEL:-info}
      - WUD_LOG_FORMAT=text

      # Web UI authentication (optional but recommended)
      - WUD_AUTH_BASIC_USER=${WUD_AUTH_USER}
      - WUD_AUTH_BASIC_PASSWORD=${WUD_AUTH_PASSWORD}

      # Timezone
      - TZ=${TZ:-America/Denver}

      # ===== WATCHERS (Enable image registries to check) =====
      # Local Docker containers
      - WUD_WATCHER_LOCAL_SOCKET=/var/run/docker.sock
      - WUD_WATCHER_LOCAL_WATCHBYDEFAULT=true
      - WUD_WATCHER_LOCAL_WATCHALL=true

      # ===== UPDATE CHECK INTERVAL =====
      # Cron expression for checking updates (default: every 15 minutes)
      - WUD_WATCHER_LOCAL_CRON=${WATCH_SCHEDULE:-0 */6 * * *}

      # ===== NOTIFIERS =====
      # Ntfy.sh (recommended - simple push notifications)
      - WUD_NOTIFIER_NTFY_URL=${NTFY_ENDPOINT}
      - WUD_NOTIFIER_NTFY_TOPIC=${NTFY_TOPIC}
      - WUD_NOTIFIER_NTFY_PRIORITY=${NTFY_PRIORITY:-default}

      # Email (SMTP)
      - WUD_NOTIFIER_SMTP_HOST=${SMTP_HOST}
      - WUD_NOTIFIER_SMTP_PORT=${SMTP_PORT:-587}
      - WUD_NOTIFIER_SMTP_USER=${SMTP_USER}
      - WUD_NOTIFIER_SMTP_PASSWORD=${SMTP_PASSWORD}
      - WUD_NOTIFIER_SMTP_FROM=${SMTP_FROM}
      - WUD_NOTIFIER_SMTP_TO=${SMTP_TO}

      # Discord webhook
      - WUD_NOTIFIER_DISCORD_URL=${DISCORD_WEBHOOK_URL}

      # Slack webhook
      - WUD_NOTIFIER_SLACK_URL=${SLACK_WEBHOOK_URL}

      # Telegram
      - WUD_NOTIFIER_TELEGRAM_BOTTOKEN=${TELEGRAM_BOT_TOKEN}
      - WUD_NOTIFIER_TELEGRAM_CHATID=${TELEGRAM_CHAT_ID}

      # Gotify
      - WUD_NOTIFIER_GOTIFY_URL=${GOTIFY_URL}
      - WUD_NOTIFIER_GOTIFY_TOKEN=${GOTIFY_TOKEN}

      # Pushover
      - WUD_NOTIFIER_PUSHOVER_TOKEN=${PUSHOVER_TOKEN}
      - WUD_NOTIFIER_PUSHOVER_USER=${PUSHOVER_USER}

      # Apprise (supports many services)
      - WUD_NOTIFIER_APPRISE_URL=${APPRISE_URL}

      # ===== TRIGGERS (Actions to take on updates) =====
      # Webhook trigger (call a webhook when update is available)
      - WUD_TRIGGER_WEBHOOK_URL=${WEBHOOK_URL}

    labels:
      # Don't watch WUD itself
      - wud.watch=false
      # Optional Traefik labels (if using Traefik)
      - traefik.enable=true
      - traefik.http.routers.wud.rule=Host(`wud.${DOMAIN:-home}`)
      - traefik.http.routers.wud.entrypoints=websecure
      - traefik.http.routers.wud.tls=true
      - traefik.http.services.wud.loadbalancer.server.port=${WUD_PORT:-3000}

networks:
  default:
    name: traefik-network
    external: true
